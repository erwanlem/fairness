\documentclass{article}
\usepackage[T1]{fontenc}

\usepackage{graphicx}
\usepackage{parskip}
\usepackage[colorlinks=true,linkcolor=black]{hyperref}
\usepackage[french]{babel}
\usepackage{subcaption}
\usepackage[french]{babel}

\usepackage[margin=3.5cm]{geometry}


\author{Erwan LEMATTRE, Yannis CHUPIN}
\title{Rapport mi-projet\\Fairness pour l'IA}

\begin{document}
    \maketitle
    \newpage
    \tableofcontents
    \newpage

    \section{Introduction}
    Ce projet a pour objectif d'analyser les accidents de la circulation routière afin de pouvoir déterminer 
    à partir des données d'un véhicule accidenté si l'accident est mortel ou non.
    Les données sont des données libres mises à disposition par le \textit{Ministère de l'Intérieur et des 
    Outre-Mer}. Le jeu de données correspond aux accidents de 2005 à 2022 en France. Nous allons, dans une première 
    partie, analyser ces données afin d'extraire les informations utiles à l'apprentissage. Puis nous essaierons de repérer 
    d'éventuelles sources de biais affectant notre modèle.
    
    Vous pouvez retrouver le code sur le GitHub du projet. Le fichier \texttt{main.ipynb} contient 
    le code principal que nous allons suivre et contextualiser tout au long de ce rapport. de plus, le fichier \texttt{utils.py} 
    contient toutes les fonctions auxiliaires que nous utilisons dans le fichier principal.

    \section{Découverte du jeu de données}
    \subsection{La base de données}
    La base de données est composée de plusieurs tables : \textit{usagers}, \textit{véhicules}, \textit{lieux} et 
    \textit{caractéristiques}. Nous avons joint ces quatre parties pour obtenir un dataframe contenant une 
    cinquantaine de colonnes. 
    On peut retrouver l'ensemble des attributs dans l'annexe \ref{appendix:dataset}.


    \subsection{Répartition des données}
    Afin de pouvoir conserver les données utiles pour l'apprentissage, nous avons analysé la répartition des 
    différentes données dans notre dataframe.
    Nous avons ainsi pu faire différentes observations. 
    \\
    Voici quelques-unes d'entre elles qui nous sont ensuite utiles pour la préparation des données.
    \subsubsection{Catégories de véhicule}
    La base de données contient beaucoup de type de véhicules différents. Nous avons cependant pu remarquer 
    que la majorité des véhicules sont dans seulement 5 catégories.
    \begin{figure}[ht]
        \centering
        \includegraphics[width=12cm]{./img/catv1.png}
        \caption{Répartition des catégories de véhicules}
    \end{figure}

    \subsubsection{Gravité de l'accident}
    En affichant l'effectif d'individus décédés dans un accident, nous avons pu remarquer qu'ils ne représentent qu'une 
    infime partie des individus accidentés. Leur proportion est si fable que ça ne nous permet pas d'apprendre 
    un modèle. C'est la raison pour laquelle nous avons décidé de nous intéresser non pas à la mortalité 
    à l'échelle d'une personne, mais plutôt à l'échelle d'un accident. Nous nous mettons pour cela au niveau d'un 
    véhicule car cela nous permet de conserver plus d'informations (à l'échelle d'un accident, on aurait 
    dû enlever trop d'informations pour ne conserver que les attributs plus généraux à l'accident).

    \begin{figure}[ht]
        \centering
        \includegraphics[width=12cm]{./img/grav1.png}
        \caption{Proportion d'accidents mortels}
    \end{figure}

    \section{Préparation des données}
    À partir des observations précédentes, nous avons supprimé les attributs moins intéressants pour l'apprentissage 
    et nous avons modifié certains attributs afin d'en extraire les informations intéressantes.
    \\
    Les attributs supprimés sont : \textit{voie}, \textit{v1}, \textit{v2}, \textit{pr}, \textit{pr1}, \textit{lartpc},
    \textit{larrout}, \textit{num\_veh}, \textit{occutc}, \textit{adr}, \textit{senc}, \textit{etatp}, \textit{actp}, 
    \textit{manv}, \textit{jour}, \textit{com}, \textit{hrmn}, \textit{motor}, \textit{place}, \textit{vosp}, \textit{locp}.
    \\\\
    Nous avons effectué les modifications suivantes :
    \begin{itemize}
        \item Création d'un attribut \textit{mortal} qui vaut 1 si le véhicule est impliqué dans un accident mortel, 0 sinon.
        \item À partir de l'attribut \textit{sexe}, nous avons créé un attribut \textit{sexe\_conducteur} qui garde seulement 
                le sexe du conducteur du véhicule.
        \item Création d'un attribut \textit{piéton} qui vaut 1 si un piéton est impliqué dans l'accident, sinon 0.
        \item Nous avons utilisé l'année de naissance et l'année de l'accident pour récupérer l'âge du conducteur.
        \item L'attribut \textit{vma} a été découpé en 4 catégories de vitesse.
        \item Pour les attributs \textit{catv} et \textit{catr}, nous avons gardé les valeurs les plus représentées dans la base de données.
    \end{itemize}
    \vspace{0.5cm}
    Nous avons également réduit les valeurs de certains attributs. Par exemple, pour des attributs 
    avec des valeurs telles que \textit{Non-renseigné}, \textit{Autre}, \dots \, nous avons regroupé 
    ces valeurs en une seule valeur. L'objectif était ici de simplifier en réduisant les catégories 
    mais également d'améliorer les performances de notre modèle.

    \section{Analyse des données}
    Une fois nos données préparées, nous avons pu les visualiser. Nous allons montrer dans les 
    deux prochaines parties les observations intéressantes que nous avons pu faire lors de 
    l'analyse de notre dataset.
    
    \subsection{Analyse univariée des données}
    \subsubsection{Les accidents mortels}
    Une donnée intéressante à observer est la proportion de véhicules impliqués dans un accident 
    mortel. C'est en effet la valeur que nous voulons prédire.

    \begin{figure}[ht]
        \centering
        \includegraphics[width=10cm]{./img/grav2.png}
        \caption{Proportion des véhicules impliqués dans un accident mortel}\label{fig:fig_acc_mortel}
    \end{figure}

    Nous pouvons remarquer sur la figure \ref{fig:fig_acc_mortel} que le fait de s'intéresser 
    aux véhicules impliqués dans un accident mortel et non plus aux personnes nous permet 
    de doubler ce pourcentage. Même si cette proportion reste faible, cela va nous permettre 
    d'avoir plus de données dans la catégorie mortelle lors de l'apprentissage et par conséquent 
    d'avoir un meilleur modèle.

    \subsubsection{Les piétons}
    Nous nous sommes ensuite intéressés aux accidents dans lesquels un piéton est impliqué. 
    La figure \ref{fig:fig_acc_pieton} nous montre qu'un peu moins de 10\% des accidents impliquent 
    un piéton.

    \begin{figure}[ht]
        \centering
        \includegraphics[width=10cm]{./img/pieton.png}
        \caption{Proportion des accidents avec piéton}\label{fig:fig_acc_pieton}
    \end{figure}

    \subsubsection{L'âge}
    Nous pouvons visualiser l'âge des conducteurs via une boîte à moustache. La figure \ref{fig:fig_age} nous 
    montre la répartition de l'âge des conducteurs. Lors du prétraitement des données, les valeurs aberrantes 
    ont été enlevées. On retrouve donc logiquement des âges contenus entre 0 et 100 ans. L'âge médian des 
    conducteurs est 33 ans avec le premier quartile à 21 et le troisième quartile à 49 ans. Même si on peut 
    imaginer que des valeurs sont fausses (il y a des conducteurs de moins de 16 ans), les valeurs sont tout de 
    même assez cohérentes par rapport à ce que l'on pourrait imaginer de la répartition de l'âge des conducteurs.

    \begin{figure}[ht]
        \centering
        \includegraphics[width=12cm]{./img/age.png}
        \caption{Âge des conducteurs}\label{fig:fig_age}
    \end{figure}

    \subsubsection{Le genre des conducteurs}
    Le genre des conducteurs est assez intéressant à analyser. Sur la figure \ref{fig:fig_genre}, nous pouvons 
    remarquer une différence importante entre le nombre de femmes au volant d'un véhicule ayant eu un accident 
    (indice 0) et le nombre d'hommes (indice 1). Cette différence pourrait être une source de biais pour notre modèle. 
    En effet, le fait qu'il y ait beaucoup plus de données d'accident avec des hommes ne signifie pas qu'il y a plus 
    de chances d'avoir un accident si on est un homme. Cela signifie peut-être que la proportion d'hommes au volant 
    est plus élevée et donc qu'il y a plus d'accidents avec un homme au volant car il y a plus d'hommes au volant. Le 
    risque ici est que notre modèle associe un homme à un accident mortel car il y a beaucoup plus d'accidents mortels 
    avec un homme au volant.

    \begin{figure}[ht]
        \centering
        \includegraphics[width=12cm]{./img/sexe.png}
        \caption{Genre des conducteurs}\label{fig:fig_genre}
    \end{figure}

    \subsubsection{Le type de collision}
    La figure \ref{fig:fig_col} montre la répartition des différents types de collisions dans notre dataset. On peut 
    remarquer que tous les types de collisions sont plutôt bien représentés dans notre dataset. C'est un attribut qui 
    pourra être assez intéressant pour l'apprentissage.

    \begin{figure}[ht]
        \centering
        \includegraphics[width=12cm]{./img/col.png}
        \caption{Les types de collision}\label{fig:fig_col}
    \end{figure}

    \subsection{Analyse bivariée des données}
    Nous allons dans cette partie donner quelques exemples intéressants obtenus lors de l'analyse bivariée. On 
    peut retrouver l'ensemble des graphiques observés dans le fichier \texttt{main.ipynb}.

    \subsubsection{Le genre du conducteur}
    Un attribut qu'il est intéressant d'analyser est le genre du conducteur. En effet, il peut être source de biais 
    s'il y a un déséquilibre entre hommes et femmes.
    On retrouve globalement la même proportion dans la corrélation que l'on soit homme ou femme. Les hommes étant 
    beaucoup plus représentés dans le dataset, la proportion d'hommes est logiquement plus élevée. On peut cependant 
    faire quelques remarques. 
    
    La figure \ref{fig:fig_sexe_bivar1} nous montre une proportion de femmes moins élevée quand \textit{obsm} vaut 
    \textit{6}. La proportion de femmes est deux fois plus élevée quand \textit{obsm} vaut \textit{1}. Ceci pourrait biaiser notre 
    modèle.
    
    Sur la figure \ref{fig:fig_sexe_bivar2}, on remarque également une proportion différente de femmes 
    en fonction du type de véhicule. On pourrait expliquer cela par le fait que certains véhicules sont 
    dans la réalité plus utilisés par les hommes, par exemple on pourrait imaginer qu'il y a plus d'hommes qui 
    conduisent des motos. Il faudra être vigilant car cela peut être source de biais. Il se peut que notre 
    modèle associe une moto à un homme. Et que dans le cas d'une femme sur une moto le résultat soit 
    forcément un accident mortel, ou bien forcément un accident non mortel.

    \begin{figure}[h]
        \centering
        \begin{subfigure}{7cm}
            \includegraphics[width=7cm]{./img/bivar_sexe.png}
            \caption{Proportion femmes/hommes en fonction de la présence d'un obstacle dans l'accident}\label{fig:fig_sexe_bivar1}
        \end{subfigure}
        \hspace{0.2cm}
        \begin{subfigure}{7cm}
            \includegraphics[width=7cm]{./img/bivar_sexe2.png}
        \caption{Proportion femmes/hommes en fonction de la catégorie du véhicule}\label{fig:fig_sexe_bivar2}
        \end{subfigure}
    \end{figure}
    \vspace{2cm}

    \subsubsection{L'âge du conducteur}
    On peut remarquer sur la figure \ref{fig:fig_age_bivar} que la probabilité d'accident mortel beaucoup plus élevée à l'âge de 
    21 ans. Cela est dû en partie au fait que les conducteurs de 21 ans sont surreprésentés. Cette probabilité risque de poser 
    problème pour notre modèle. En effet l'âge n'est pas un paramètre déterminant dans l'évaluation de la gravité de l'accident. 
    Le problème est que notre modèle va probablement associer l'âge de 21 ans à un accident mortel, peu importe les autres paramètres 
    de l'accident. L'âge serait donc notre \textbf{attribut sensible}.

    \begin{figure}[ht]
        \centering
        \includegraphics[width=14cm]{./img/bivar_age.png}
        \caption{Analyse bivariée âge -- accident mortel}\label{fig:fig_age_bivar}
    \end{figure}
    
    \section{Apprentissage}
    
    \subsection{Split}
    Séparer nos données en deux ensembles demandait de tenir compte d'une spécificité. Nous nous plaçons du point de vue d'un véhicule, 
    mais bien souvent, plusieurs véhicules sont impliqués dans un  même accident. Il nous a donc fallu adapter le split pour que les 
    véhicules d'un même accident soient dans le même ensemble. 
    
    Par ailleurs, nous avons constaté que, si l'on ne le faisait pas, un surapprentissage lors du test se produisait. Typiquement, un trop grand 
    nombre de morts étaient correctement prédits. Mais le modèle trouvait une partie de ces véhicules en les associant à ceux avec lesquels
    ils avaient eu un accident dans l'ensemble d'apprentissage. 
    
    \subsection{Encodage One Hot}
    La base de données nous fournit, pour la plupart des attributs, des données qui peuvent être converties en entiers. 
    Par exemple, une catégorie de véhicule (\textit{catv}) est désignée par un chiffre. L'attribut reste cependant catégoriel. En pratique, 
    les seuls attributs quantitatifs qui nous restent sont l'âge du conducteur, les mois et les départements. 
    Le reste est soit binaire, soit qualitatif. 
    
    Tous les attributs qualitatifs ont donc été transformés en OneHot. Initialement, nous souhaitions optimiser le nombre de colonnes en 
    réalisant les OneHot nous-mêmes. Par exemple, prenons "surf" (l'état de la surface de la route). Il est inutile de créer une colonne 
    pour "Non-renseigné", "Autre" ou "normale". Nous sommes uniquement intéressés par les états spécifiques de la route. 
    
    Cependant, cette approche posait des problèmes car elle empêchait la réalisation de l'audit. Nous avons donc utilisé la méthode 
    standard pour nos OneHot. 
    
    \subsection{Arbre de décision}
    Une fois les données prêtes, nous avons utilisé le classifieur par arbres de décision pour obtenir un modèle. C'est le premier que nous 
    avons utilisé. En ce qui concerne les résultats, le score d'accuracy est de \textit{1} pour l'entraînement et de \textit{0.9014} pour le test.
        
    En ce qui concerne la matrice de confusion, on remarque que \textit{27687} véhicules ont été classés correctement en tant qu'accidents non létaux.
    Tandis que \textit{291} accidents mortels seulement ont été correctement identifiés. Cependant, \textit{1413} accidents mortels ont été recensés à tort 
    comme étant non létaux et \textit{1648} véhicules ont subi le sort inverse. 
    
    \begin{figure}[h]
        \centering
        \includegraphics[width=\textwidth]{./img/matrice_confusion_tree.png}
        \caption{La matrice de confusion pour le classifieur d'arbres aléatoires}
    \end{figure}
    

    En résumé, on remarque que le modèle réussit très bien à classifier les accidents qui n'ont pas conduit à la mort de quelqu'un. Cependant, 
    il lui apparaît bien plus difficile de trouver les véhicules impliqués dans des accidents mortels. On peut attribuer ceci au fait que ces 
    accidents létaux ne représentent que \textit{5.38\%} des véhicules accidentés répertoriés dans la base.

    \subsection{GaussianNB}
    Avancés dans le projet, nous avons voulu tester plusieurs classifieurs, tous ont donné des résultats différents, pour certains médiocres. 
    Mais nous avons trouvé un autre classifieur qui donnait des résultats intéressants : GaussianNB.
        
    Il ne maximise pas notre accuracy score puisqu'il n'est que de \textit{0.8734} à l'entraînement et de \textit{0.8677} pour les tests. Ce qui 
    a toutefois retenu notre attention, c'est le nombre d'accidents létaux qu'il parvient à détecter : \textit{508}. Réduisant ainsi l'erreur associée
    (les accidents mortels recensés à tort comme étant non létaux) à seulement \textit{1196}. Ceci s'accompagne malheureusement une perte de performances 
    pour ce qui est de la détection d'accidents non mortels comme on peut le voir ci-dessous.

    \begin{figure}[h]
        \centering
        \includegraphics[width=\textwidth]{./img/matrice_confusion_gaussien.png}
        \caption{La matrice de confusion avec GaussianNB}
    \end{figure}

    Un autre avantage qui peut ressembler à un inconvénient au départ est que ce classifieur demande des nombres et non des OneHot.
    Nos valeurs au départ sont en format numérique, rendant donc nos données compatibles avec cette approche.
    Ceci nous ouvre alors la possibilité de tester d'autres choses puisque le classifieur donne des probabilités et non des arbres. Au premier 
    rang desquels \textit{xplique}.
        
    Par souci de concision cependant, nous prendrons le modèle issu du \textit{tree classifier} pour tous les audits qui vont suivre, 
    puisque c'est le premier avec lequel nous avons travaillé. On notera tout de même que lorsqu'on effectue ces audits avec \textit{GaussianNB}, 
    les résultats diffèrent en bien des points de ceux observés avec le \textit{tree classifier}, preuve qu'ils ont une approche bien différente.

    \subsection{Base Rate}

    Nous avons voulu mesurer les résultats méritant potentiellement une protection : le fait qu'un piéton soit impliqué dans 
    un accident et le sexe du conducteur. Voici les résultats :

    \begin{itemize}
        \item \textbf{Sexe du conducteur} 1 (un homme)
        \item \textbf{Disparate Impact} : 1.21767750298587 1.6331199049428085
        \item \textbf{P-rule disparate Impact} : 0.8212355057458954 0.6123249107266375
        \item \textbf{Démographie Parité} : 0.011747835864606336 0.02383701239031672
    \end{itemize}

    Ce qui est flagrant ici, c'est qu'il existe une disparité dans la prédiction d'accidents mortels pour les hommes. Allant par ailleurs
    dans le sens de ce qu'indique Disparate Impact par la suite. Notons cependant que la disparité démographique entre hommes et femmes
    existe mais est très faible.

    \begin{itemize}
        \item \textbf{Piéton} 1 (un piéton est impliqué)
        \item \textbf{Disparate Impact} : 1.0538191011165416 1.0968113720110815
        \item \textbf{P-rule Disparate Impact} : 0.9489294689576994 0.9117337999207913
        \item \textbf{Démographie Parité} : 0.003345154811069756 0.005266913173450724
    \end{itemize}

    Pour ce qui est de l'implication d'un piéton dans un accident, on constate ici aussi une légère disparité, soulignant leur
    plus grande implication dans des accidents mortels. Ceci concorde encore une fois avec le \textit{disparate Impact}. Démographiquement, 
    le cas est similaire au sexe, puisqu'on constate une légère disparité en leur faveur, bien que cette fois la disparité soit plus
    faible encore.

    \section{Audit du modèle}

    \subsection{Génération des contrefactuels avec Dice}
    Dice nous a permis d'établir quels attributs influent sur la prédiction de notre modèle. Les résultats sont 
    cependant assez variables d'une exécution à l'autre. On peut tout de même retrouver lesquels sont fréquemment impliqués 
    dans le changement des exemples contrefactuels.
    Parmi eux, on peut noter que l'attribut \textit{âge} est souvent représenté. Le taux d'accidents (notamment mortels) étant plus 
    élevé chez les jeunes et les personnes âgées, cela paraît assez cohérent. L'attribut \textit{obsm} est également 
    souvent utilisé dans les exemples contrefactuels.
    Nous avons pu remarquer que l'attribut \textit{col} est peu représenté dans les résultats, contrairement à l'hypothèse que 
    nous avions pu faire lors de l'analyse.

    Enfin, les attributs \textit{dep} et \textit{sexe\_conducteur} sont également représentés. Ils pourraient être sources de biais, notamment 
    l'attribut \textit{dep} ; le modèle pourrait associer un département à une prédiction d'accident mortel.


    \subsection{BlackBoxAuditing}
    Les résultats que nous allons analyser sont issus du modèle généré par \textit{tree classifier}.

    Tout d'abord, l'audit a porté sur les 24 features que nous avons conservés afin d'élaborer ce modèle. 
    On constate tout d'abord le rôle prédominant de l'âge pour l'accuracy score. À \textit{0.84}, ce dernier éclipse 
    tous les autres. Une explication pourrait venir de ce que nous avons constaté dans notre analyse univariée : il y a une 
    surreprésentation des jeunes de 20--21 ans dans ce set. Ceci est en réalité loin de surprendre puisqu'il s'aligne avec la 
    politique de prix pratiquée par les assureurs envers les jeunes conducteurs.

    Par la suite, on peut s'intéresser à l'évolution de l'accuracy en fonction du niveau de réparation appliqué à chaque 
    attribut :

    \begin{figure}[h]
        \centering
        \includegraphics[width=10cm]{./img/accuracy.png}
        \caption{L'accuracy en fonction du niveau de réparation pour chaque attribut.}
    \end{figure}

    On reconnaît toput de suite les 
    attributs dont l'accuracy est au plus haut en regardant ceux qui s'effondrent le plus. En premier lieu, l'âge s'illustre
    à nouveau. À la lumière de ceci, il apparaît évident que le modèle discrimine fortement les véhicules en fonction de l'âge du 
    conducteur. Dans une moindre mesure, on constate la même chose pour \textit{situ}, qui fait référence à la localisation 
    géographique de l'accident. Ce qui paraît sensé, étant donné que certains lieux sont plus dangereux que d'autres. Enfin, 
    on observe que le type d'intersection et la catégorie du véhicule sont également sources de discriminations de la part de notre 
    modèle. Encore une fois, cela semble cohérent.

    Toutefois, notons l'absence de quelques attributs notables tels que le nombre de voies, le sexe du conducteur (chose intéressante :
    ce n'est pas le cas avec GaussianNB), le type de collision, le type d'obstacle heurté ou encore le fait qu'un piéton soit impliqué.
    
    Maintenant regardons l'équilibre du modèle à l'aide du BCR.

    \begin{figure}[h]
        \centering
        \includegraphics[width=10cm]{./img/BCR.png}
        \caption{Le BCR en fonction du niveau de réparation pour chaque attribut.}
    \end{figure}

    On remarque ici que les attributs sont plutôt centrés autour de \textit{0.5} et que la plupart reste rectiligne, mais que certains divergent
    quelque peu. Cet évasement est dû à des attributs déjà connus tels que \textit{âge} ou \textit{catv}. D'autres influent aussi mais ne s'étaient pas 
    illustrés précédemment, à l'image du nombre de voies (\textit{nbv}), du profil de la route (\textit{plan}) ainsi que de la luminosité (\textit{lum}). 

    Malgré cela, l'évasement assez faible laisse penser que le modèle est plutôt équilibré. De plus, comme mentionné précédemment 
    dans la section dédiée au split, nous avons pu tester le cas où l'on acceptait que des véhicules impliqués dans le même accident
    se retrouvent dans des ensembles différents (entraînement / test). Ce qu'il ressortait alors du BCR était un évasement beaucoup
    plus important et une origine située vers 0.68. Ce qui laisse à penser que cette version était bel et bien trop modelée sur le train
    set, l'équilibre était rompu.

    Pour conclure, BlackBoxAuditing nous a permis de comprendre quels étaient les attributs les plus discriminés. Âge est certainement le plus notable.

    \subsection{Expliquer le modèle avec les valeurs de Shapley}
    Afin d'analyser la contribution des différents attributs dans notre modèle, nous avons 
    utilisé les valeurs de Shapley. Nous avons d'abord essayé de calculer la valeur exacte avec la fonction 
    \verb|ShapleyValues| du module \textit{ShapKit}. Cependant, le nombre d'attributs de notre dataset est trop 
    important et le calcul trop long.
    Il a donc fallu calculer une approximation de la valeur de Shapley avec la fonction \verb|MonteCarloShapley|.
    Nous devons cependant être prudents car ce calcul de l'approximation nous 
    donne une tendance pour notre modèle mais certainement pas une valeur exacte. On peut le constater en changeant 
    le nombre d'itérations, qui produit souvent un résultat différent. Toutes les approximations ont ici été calculées 
    avec \texttt{n\_iter=1000}.

    Le temps de calcul étant encore assez long nous avons parallélisé le calcul des valeurs de Shapley. Les calculs 
    ont ensuite été séparés en deux, d'un côté pour les prédictions qui donnent 1 et de l'autre pour celles qui donnent 0.
    ON peut ainsi avoir une idée des attributs décisifs dans les deux cas.

    Ce qui ressort des résultats obtenus est que les attributs \textit{col}, \textit{choc}, \textit{obsm}, \textit{int} 
    et \textit{agg} contribuent souvent au résultat. Ce résultat paraît plutôt cohérent.
    En revanche, on retrouve également assez souvent les attributs \textit{mois}, \textit{âge} et \textit{dep}. Ces 
    attributs ne devraient pas contribuer autant à la sortie de notre modèle. Il peuvent constituer un biais (ce n'est 
    pas parce qu'on a un accident à l'âge de 21 ans que l'on va forcément mourir, d'autres attributs sont beaucoup plus 
    importants).


    Pour l'attribut \textit{sexe\_conducteur} on nous donne une contribution 
    nulle de cet attribut. Cela peut nous encourager dans l'idée que le sexe n'est pas un biais pour notre modèle 
    conrairement à ce que nous pouvions penser au départ.

    Ci-dessous un résultat obtenu du calcul des valeurs de Shapley. Vous pouvons retrouver un échantillon des résultats dans l'annexe ? de ce rapport.
    
    

    \begin{figure}[h]
        \centering
        \includegraphics[width=\textwidth]{./img/shap1.png}
        \caption{Une approximation des valeurs de Shapley}
        \label{fig:fig_shap}
    \end{figure}

    \subsection{Expliquer le modèle avec Lime}
    Nous avons également utilisé \textit{Lime} afin d'avoir une idée des attributs qui contribuent
    le plus aux prédictions de notre modèle. On peut retrouver le code correspondant dans le fichier 
    \texttt{lime.ipynb}.

    Nous avons d'abord récupéré les indices des prédictions positives de notre modèle (avec lesquelles les 
    entrées notre modèle prédit 1). Ainsi, on a pu regarder dans les cas où les prédictions sont 0 
    et les cas où les prédictions sont 1.
    On peut remarquer qu'on trouve des variables similaires à celles trouvées avec les valeurs de 
    Shapley. On retrouve notamment assez fréquemment l'attribut \textit{agg}.
    Cependant, contrairement au résultat que pouvait nous donner \textit{ShapKit}, l'attribut \textit{mois} est 
    moins représenté. Les contributions sont également plus réparties entre les attributs.
    Enfin, il semble que, comme nous avions pu l'observer avec les valeurs de Shapley, l'attribut 
    \textit{sexe\_conducteur} ait un faible impact sur la prédiction.

    \section{Conclusion}
    Pour ce projet nous avons cherché un dataset qui nous intéressait, et nous avons choisi celui rapportant les accidents de la route. Pourvu de 
    nombreux attributs, nous avons dû adapter leur format avant de pouvoir les analyser de manière univariée puis bivariée. Lors du premier essai, 
    nous avons fait le choix d'utiliser des arbres de décision. Ce qui nous a conduit à transformer beaucoup de nos variables en OneHot. L'accuracy 
    de ce modèle était élevée, mais il a du mal à trouver les accidents réellement mortels. Pour ce modèle, nous avons par la suite calculé le base 
    rate puis effectué quelques audites tels que dice, BlackBoxAuditing et shapkit.

    Par la suite nous avons essayé de trouver un classifieur qui avait de meilleures performances, c'est ainsi que nous avons trouvé GaussianNB, qui
    est meilleur pour détecter les véhicules impliqués dans des accidents vraiment mortels. Pour ce modèle nous avons aussi effectué les audits 
    évoqués précédemment, mais nous ne les avons pas analysés dans ce rapport. Ce qui conclut notre premier rendu. 

    L'analyse des données ainsi que les audits que nous avons pu faire après entrainement du modèle nous ont permis d'identifier 
    plusieurs attributs sensibles. D'abord nous pensions que le genre du conducteur pourrait avoir un impact sur la prédiction. 
    Cela aurait été un biais de notre modèle. Or nous avons pu observer via les différents outils utilisés que le genre du 
    conducteur a un impact très faible sur la prédiction du modèle. En revanche, le travail effectué nous a permis d'identifier 
    d'autres attributs sensibles qui eux ont réel impact sur les sorties du modèle. Les attributs \textit{âge}, \textit{dep} et 
    \textit{mois} sont des attributs que nous avons identifié comme sensibles pour notre modèle. Ils ont un impact assez important 
    sur les prédictions et pourtant ne devraient pas être décisifs dans la classification d'un accident mortel ou non mortel.

    \section{Une réflexion pour la suite}
    Cette première partie nous a permis de nous familiariser avec notre jeu de données. L'objectif de classification a été une 
    question qui nous a suivi du début de ce projet jusqu'à la rédaction de ce rapport. 
    Les premières conclusions nous ont mené encore une fois à la réflexion sur une nouvelle direction à suivre pour la classification. 
    Ne faudrait-il pas classifier l'ensemble des 
    gravité ? Nous nous basons dans cette première partie sur des données dans lesquelles nous avons seulement 5\% d'accidents 
    mortels. Ne serait-il pas judicieux de prendre en compte l'ensemble de gravité et donc de travailler sur des proportions 
    plus conséquentes ?

    Ces questions seront déterminantes pour la suite de ce projet.

    \newpage
    \appendix

    \section{Les données de notre dataset}\label{appendix:dataset}
    \begin{center}
        \begin{tabular}{ |c|p{9cm}| }
            \hline
            \textbf{Attribut} & \textbf{Description} \\
            \hline
            \textit{Num\_Acc} & Numéro d'identifiant de l'accident \\
            \textit{jour mois} & Jour de l'accident, mois de l'accident \\
            \textit{an} & Année de l'accident \\
            \textit{hrmn} & Heure et minutes de l'accident \\
            \textit{lum} & Conditions d'éclairage dans lesquelles l'accident s'est produit \\
            \textit{dep} & Code INSEE du département \\
            \textit{com} & Numéro de commune (code INSEE) \\
            \textit{agg} & Localisation en agglomération \\
            \textit{int} & Type d'intersection \\
            \textit{atm} & Conditions atmosphériques \\
            \textit{col} & Type de collision \\
            \textit{adr} & Adresse postale (pour les accidents en agglomération) \\
            \textit{lat} & Latitude \\
            \textit{long} & Longitude \\
            \textit{catr} & Catégorie de route \\
            \textit{voie} & Numéro de la route \\
            \textit{circ} & Régime de circulation \\
            \textit{nbv} & Nombre total de voies de circulation \\
            \textit{vosp} & Présence d'une voie réservée \\
            \textit{prof} & Profil en long de la route \\
            \textit{plan} & Tracé en plan de la route \\
            \textit{surf} & État de la surface de la route \\
            \textit{infra} & Présence d'aménagements ou d'infrastructures \\
            \textit{situ} & Situation géographique de l'accident \\
            \textit{vma} & Vitesses maximale autorisées \\
            \textit{id\_vehicule} & Identifiant du véhicule (clé étrangère) \\
            \textit{catv} & Catégorie du véhicule impliqué dans l'accident \\
            \textit{obs} & Type d'obstacle heurté \\
            \textit{obsm} & Type d'obstacle mobile heurté \\
            \textit{choc} & Point de choc initial \\
            \textit{manv} & Manœuvre principale avant l'accident \\
            \textit{catu} & Catégorie d'usager (conducteur, passager, piéton) \\
            \textit{grav} & Gravité de l'accident pour l'usager \\
            \textit{sexe} & Sexe du conducteur \\
            \textit{trajet} & Motif du déplacement au moment de l'accident \\
            \textit{mortal} & Indique si le véhicule est impliqué dans un accident mortel (calculé dans le notebook) \\
            \hline
        \end{tabular}
    \end{center}

\end{document}